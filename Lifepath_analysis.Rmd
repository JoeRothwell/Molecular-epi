---
title: "Lifepath NMR metabolomics analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Exploratory analysis

Read in metabolomics data from text file. There are 44 compounds measured for 1623 subjects, and subject identifiers in the first column, `CODBMB`.

```{r message = FALSE, warning = FALSE}
library(tidyverse)
ints <- read_tsv("1507_XMetabolite_std_cpmg_E3N.txt")
dim(ints)
head(ints)
```

Intensity data are both positive and negative and most values in between -2 and 2. Data appear to be scaled and centered.
We can plot the total intensity of each metabolite:

```{r totalintensity}
plot(colSums(ints[ , -1]), xlab = "Compound number", ylab = "Scaled intensity",
     pch = 19, col = "dodgerblue")
```

Total intensities are similar between compounds and normally distributed.We can now look at correlations between compounds:

```{r}
cormat <- cor(ints)
colnames(cormat) <- NULL
library(corrplot)
corrplot(cormat, method = "square", tl.col = "black")
```

Of note is that the three fatty acid variables are correlated, as well as valine and leucine and NAC1 and NAC2.
Next we can plot a PCA of the compound profiles:

```{r}
ints <- ints[ , -1]
pca <- prcomp(ints, scale.=F)
library(pca3d)
pca2d(pca, title = "Metabolite profiles of 1623 subjects", xlab = "Score on PC1", ylab = "Score on PC2")
```

There is one notable outlying profile in the bottom right-hand corner of the plot. This could be caused by a technical issue with the sample.